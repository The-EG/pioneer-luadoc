<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Timer</title><link rel="stylesheet" type="text/css" href="../../styles/main.css" /><script type="text/javascript" src="../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.1 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Topic401"></a><div class="CTopic TClass LLua first">
 <div class="CTitle">Timer</div>
 <div class="CBody"><p>A class to invoke functions at specific times.</p><p>The <a href="../../index.html#LuaClass:Timer" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,401);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >Timer</a> class provides a facility whereby scripts can request that a function be called at a given time, or regularly.</p><p>Pioneer provides a single <a href="../../index.html#LuaClass:Timer" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,401);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >Timer</a> object to the Lua environment. It resides in the global namespace and is simply called Timer.</p><p>The <a href="../../index.html#LuaClass:Timer" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,401);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >Timer</a> is bound to the game clock, not the OS (real time) clock. The game clock is subject to time acceleration. As such, timer triggers will not necessarily occur at the exact time you request but can arrive seconds, minutes or even hours after the requested time (game time).</p><p>Because timer functions are called outside of the normal event model, it is possible that game objects no longer exist. Consider this example:</p><pre>local enemy = Space.SpawnShipNear(&quot;eagle_lrf&quot;, Game.player, 20, 20)<br />Comms.ImportantMessage(enemy:GetLabel(), &quot;You have 20 seconds to surrender or you will be destroyed.&quot;)<br />Timer:CallAt(Game.time+20, function ()<br />    Comms.ImportantMessage(enemy:GetLabel(), &quot;You were warned. Prepare to die!&quot;)<br />    enemy:Kill(Game.player)<br />end)</pre><p>This works exactly as you'd expect: 20 seconds after the threat message is sent, the enemy comes to life and attacks the player. If however the player chooses to avoid the battle by hyperspacing away, the enemy ship is destroyed by the game engine. In that case, the &quot;enemy&quot; object held by the script is a shell, and any attempt to use it will be greeted by a Lua error.</p><p>To protect against this, you should call <a href="../../index.html#LuaClass:Object:exists" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,442);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >Object.exists</a> to confirm that the underlying object exists before trying to use it.</p></div>
</div>

<a name="Functions"></a><a name="Topic402"></a><div class="CTopic TGroup LLua">
 <div class="CTitle">Functions</div>
</div>

<a name="CallAt"></a><a name="Topic403"></a><div class="CTopic TFunction LLua">
 <div class="CTitle">CallAt</div>
 <div class="CBody"><p>Request that a function be called at a specific game time.</p><pre>Timer:CallAt(time, function)</pre><p>Time acceleration may cause the function to be called long after the desired time has passed.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">time</td><td class="CDLDefinition"><p>the absolute game time to call the function at. This will usually be created by adding some small amount to <a href="../../index.html#LuaClass:Game:time" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,474);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >Game.time</a>.</p></td></tr><tr><td class="CDLEntry">function</td><td class="CDLDefinition"><p>the function to call. Takes no parameters and returns nothing.</p></td></tr></table><div class="CHeading">Example</div><pre>Timer:CallAt(Game.time+30, function ()<br />    Comms.Message(&quot;Special offer expired, sorry.&quot;)<br />end)</pre><div class="CHeading">Availability</div><p>alpha 10</p><div class="CHeading">Status</div><p>stable</p></div>
</div>

<a name="CallEvery"></a><a name="Topic404"></a><div class="CTopic TFunction LLua last">
 <div class="CTitle">CallEvery</div>
 <div class="CBody"><p>Request that a function be called over at over at a regular interval.</p><pre>Timer:CallEvery(interval, function)</pre><p>Since the <a href="../../index.html#LuaClass:Timer" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,401);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >Timer</a> system is locked to the game time, time acceleration may cause the function to be called more frequently than the corresponding number of real-time seconds. Even under time acceleration, the function will never called more than once per real-time second.</p><p>If the called function returns a false value (as is the default for Lua when no return value is specified), the timer will continue to be triggered after each interval. To request that no further timer events be fired, the function should explicitly return a true value.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">time</td><td class="CDLDefinition"><p>the interval between calls to the function, in seconds</p></td></tr><tr><td class="CDLEntry">function</td><td class="CDLDefinition"><p>the function to call. Returns false to continue receiving calls after the next interval, or true to cancel the timer.</p></td></tr></table><div class="CHeading">Example</div><pre>-- dump fuel every two seconds until none left<br />Timer:CallEvery(2, function ()<br />    local did_dump = Game.player:Jettison(Equipment.cargo.hydrogen)<br />    return not did_dump<br />end)</pre><div class="CHeading">Availability</div><p>alpha 10</p><div class="CHeading">Status</div><p>stable</p></div>
</div>

</body></html>